---
phase: 06-gifts-basics-and-safety-controls
plan: "03"
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - apps/web/src/routes/dashboard.gifts.tsx
  - apps/web/src/components/gifts/gifts-mode-editor.tsx
  - apps/web/src/components/gifts/gifts-safety-controls.tsx
  - apps/web/src/components/gifts/gifts-item-table.tsx
  - apps/web/src/routeTree.gen.ts
autonomous: false
user_setup: []
must_haves:
  truths:
    - "Parent operator dashboard supports both UPI details and wishlist item draft editing with explicit publish flow."
    - "Hide, disable, and publish controls are exposed with state-aware guardrails and clear copy that matches locked safety semantics."
    - "Admin/coordinator authorization failures are surfaced as explicit actionable errors rather than silent failures."
  artifacts:
    - path: apps/web/src/routes/dashboard.gifts.tsx
      provides: Main dashboard gifts route with server-backed state view, edit form, lifecycle actions, and unavailable-state preview
      min_lines: 260
      contains: createFileRoute("/dashboard/gifts")
    - path: apps/web/src/components/gifts/gifts-mode-editor.tsx
      provides: Draft editor for UPI details, pre-publish note, and wishlist item management
      min_lines: 160
      contains: export function GiftsModeEditor
    - path: apps/web/src/components/gifts/gifts-safety-controls.tsx
      provides: Publish/hide/disable action controls with current-status aware enable/disable logic
      min_lines: 100
      contains: export function GiftsSafetyControls
    - path: apps/web/src/components/gifts/gifts-item-table.tsx
      provides: Wishlist item table showing target, raised amount, progress percent, and completed badge states
      min_lines: 120
      contains: export function GiftsItemTable
  key_links:
    - from: apps/web/src/routes/dashboard.gifts.tsx
      to: packages/api/src/routers/gifts.ts
      via: Typed oRPC queries/mutations for draft edits and safety actions
    - from: apps/web/src/components/gifts/gifts-safety-controls.tsx
      to: .gsd/phases/06-gifts-basics-and-safety-controls/06-CONTEXT.md
      via: Control behavior follows locked hide/disable/publish semantics
---

<objective>
Deliver the parent/coordinator dashboard UI for managing gifts mode and enforcing safety controls.

Purpose: Make GFT-01 and GFT-02 operationally usable for operators with explicit, low-risk action flows.
Output: `/dashboard/gifts` route and reusable components for editing gift details/items and running publish/hide/disable controls.
</objective>

<execution_context>
@~/.kilocode/skills/execute-plan/SKILL.md
@~/.kilocode/rules/checkpoints.md
@.gsd/templates/summary.md
</execution_context>

<context>
@.gsd/phases/06-gifts-basics-and-safety-controls/06-CONTEXT.md
@.gsd/phases/06-gifts-basics-and-safety-controls/06-02-PLAN.md
@apps/web/src/routes/dashboard.operations.tsx
@apps/web/src/routes/dashboard.invites.tsx
@apps/web/src/components/ui/card.tsx
@packages/api/src/routers/gifts.ts
</context>

<tasks>
<task type="auto">
  <name>Task 1: Build `/dashboard/gifts` route and data wiring</name>
  <files>apps/web/src/routes/dashboard.gifts.tsx</files>
  <action>Create route that loads admin gifts state (mode status, UPI details, wishlist items, audit-relevant status metadata), wires draft edit/save mutations, and renders state-aware loading/error/empty flows. Keep server as single source of truth for lifecycle status and raised totals.</action>
  <verify>Route compiles and reflects API state transitions without client-side lifecycle recomputation.</verify>
  <done>Operators have a dedicated gifts management dashboard entrypoint.</done>
</task>

<task type="auto">
  <name>Task 2: Implement draft editor and wishlist progress surfaces</name>
  <files>apps/web/src/components/gifts/gifts-mode-editor.tsx, apps/web/src/components/gifts/gifts-item-table.tsx</files>
  <action>Build editable fields for UPI details and mandatory pre-publish note, plus wishlist item add/edit/remove controls. Render progress with amount raised + percent and a completed badge when target is reached while keeping completed items visible.</action>
  <verify>Editor enforces required note before publish action is enabled and table always shows completed items with completion state.</verify>
  <done>Draft content management aligns with locked contribution/progress requirements.</done>
</task>

<task type="auto">
  <name>Task 3: Add publish/hide/disable controls, route registration, and explicit auth errors</name>
  <files>apps/web/src/components/gifts/gifts-safety-controls.tsx, apps/web/src/routes/dashboard.gifts.tsx, apps/web/src/routeTree.gen.ts</files>
  <action>Implement action controls for publish/hide/disable using state-appropriate enable/disable rules, confirmation UX for destructive transitions, and explicit rendering for forbidden errors returned by API. Regenerate route tree with `/dashboard/gifts`.</action>
  <verify>Web build succeeds and route tree includes the new dashboard gifts route.</verify>
  <done>Safety controls are accessible, guarded, and auditable from dashboard UI.</done>
</task>

<task type="auto">
  <name>Task 4: Start and verify web dev server for dashboard checkpoint</name>
  <files>None (runtime verification setup)</files>
  <action>Start the web dev server in background (for example, `bun run --filter web dev`) and confirm `http://localhost:3000/dashboard/gifts` is reachable before human verification.</action>
  <verify>`curl http://localhost:3000/dashboard/gifts` returns HTTP 200 (or framework redirect response that resolves to the route).</verify>
  <done>Checkpoint runs against an explicitly available local URL.</done>
</task>

<task type="auto">
  <name>Task 5: Prepare deterministic authorized and unauthorized dashboard sessions</name>
  <files>None (runtime verification setup)</files>
  <action>Persist two reusable session contexts for the same wedding at `/dashboard/gifts`: (A) authorized operator (admin/coordinator) at `.gsd/tmp/06-03-authorized-operator.session` and (B) unauthorized actor at `.gsd/tmp/06-03-unauthorized.session`. Pre-hit one gifts safety mutation in the unauthorized context to confirm deterministic 403/forbidden behavior is reproducible.</action>
  <verify>Both session artifacts exist, authorized context loads dashboard gifts controls, and unauthorized context reproduces explicit forbidden error response instead of silent failure.</verify>
  <done>Checkpoint has deterministic activation contexts for both positive and negative authorization paths.</done>
</task>

<task type="auto">
  <name>Task 6: Generate deterministic dashboard-gifts verification runbook</name>
  <files>.gsd/tmp/06-03-dashboard-gifts-runbook.md</files>
  <action>Create `.gsd/tmp/06-03-dashboard-gifts-runbook.md` with exact verification instructions including: concrete URL `http://localhost:3000/dashboard/gifts`; browser window mapping (`Window A = authorized operator session`, `Window B = unauthorized session`); session-to-window mapping using the artifacts from Task 5; and expected outcomes for each step (draft edit visibility, pre-publish note guard, hide/disable status messaging, completed badge visibility, explicit unauthorized error copy).</action>
  <verify>Runbook file exists, contains exact URL/window/session mapping, and lists deterministic expected outcomes per numbered step.</verify>
  <done>Human checkpoint can execute authorization-path verification without ambiguity or CLI setup.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dashboard gifts management route with draft editing, item progress, and publish/hide/disable safety controls</what-built>
  <how-to-verify>
    Use `.gsd/tmp/06-03-dashboard-gifts-runbook.md` and execute its numbered steps:
    1. Runbook Step 1 (Window A authorized baseline and editable draft visibility).
    2. Runbook Step 2 (Window A pre-publish note guard behavior).
    3. Runbook Step 3 (Window A hide/disable lifecycle messaging and completed-item visibility).
    4. Runbook Step 4 (Window B unauthorized publish/hide/disable attempt shows explicit authorization error copy).
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>
</tasks>

<verification>
- [ ] `bunx tsc --noEmit -p apps/web/tsconfig.json` succeeds.
- [ ] `bun run --filter web build` succeeds.
- [ ] `/dashboard/gifts` exists in generated route tree.
- [ ] Human checkpoint confirms draft editing + safety controls + completed item visibility behavior.
</verification>

<success_criteria>
- All tasks completed.
- Parent Admin/Coordinator can manage gifts mode end-to-end from dashboard.
- Safety controls are operator-usable with explicit guardrails and error handling.
</success_criteria>

<output>
After completion, create `.gsd/phases/06-gifts-basics-and-safety-controls/06-03-SUMMARY.md`.
</output>
