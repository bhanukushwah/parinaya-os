---
phase: 03-whatsapp-invite-delivery-and-compliance-safety
plan: "04"
type: execute
wave: 1
depends_on: ["03-02", "03-03"]
files_modified:
  - apps/web/src/routes/dashboard.invites.tsx
  - apps/web/src/routes/dashboard.invites.$runId.tsx
  - apps/web/src/routeTree.gen.ts
  - apps/web/src/lib/orpc.ts
autonomous: true
user_setup: []
must_haves:
  truths:
    - "Parent Admin can trigger invite send runs from dashboard using existing audience context inputs."
    - "Operators can view per-run and per-message lifecycle outcomes including blocked reasons and delivery states."
    - "UI status rendering reflects server-owned lifecycle state and never computes status transitions client-side."
  artifacts:
    - path: apps/web/src/routes/dashboard.invites.tsx
      provides: Send-run creation and run listing surface for invite operations
      min_lines: 180
      contains: createFileRoute("/dashboard/invites")
    - path: apps/web/src/routes/dashboard.invites.$runId.tsx
      provides: Detailed run drill-down with per-message lifecycle and rejection visibility
      min_lines: 160
      contains: createFileRoute("/dashboard/invites/$runId")
    - path: apps/web/src/routeTree.gen.ts
      provides: Generated route tree entries for new invite dashboard routes
  key_links:
    - from: apps/web/src/routes/dashboard.invites.tsx
      to: packages/api/src/routers/invites.ts
      via: Typed oRPC mutation/query wiring for send run create/list operations
    - from: apps/web/src/routes/dashboard.invites.$runId.tsx
      to: packages/api/src/routers/invites.ts
      via: Typed oRPC query wiring for run-detail lifecycle projection
---

<objective>
Deliver operator-facing invite send and lifecycle visibility surfaces in the web dashboard.

Purpose: Make WA-01 and WA-02 behavior operationally usable by Parent Admins without bypassing server controls.
Output: Dashboard routes for send execution and run/message status monitoring.
</objective>

<execution_context>
@~/.kilocode/skills/execute-plan/SKILL.md
@.gsd/templates/summary.md
</execution_context>

<context>
@.gsd/phases/03-whatsapp-invite-delivery-and-compliance-safety/03-02-PLAN.md
@.gsd/phases/03-whatsapp-invite-delivery-and-compliance-safety/03-03-PLAN.md
@apps/web/src/routes/dashboard.events.$eventId.audience.tsx
@apps/web/src/routes/dashboard.events.tsx
@apps/web/src/lib/orpc.ts
@packages/api/src/routers/invites.ts
</context>

<tasks>
<task type="auto">
  <name>Task 1: Build invite operations dashboard route</name>
  <files>apps/web/src/routes/dashboard.invites.tsx</files>
  <action>Create Parent Admin-focused dashboard route with event/audience context inputs, send action trigger, and historical run listing. Show run-level counters (eligible, blocked, sent, failed) returned from server contract.</action>
  <verify>Route compiles and can call invite send/list procedures through typed oRPC client.</verify>
  <done>Operators can initiate sends and inspect run summaries from dashboard UI.</done>
</task>

<task type="auto">
  <name>Task 2: Build run detail lifecycle route</name>
  <files>apps/web/src/routes/dashboard.invites.$runId.tsx</files>
  <action>Create run-detail page that renders per-message recipient target, current lifecycle status, timestamps, and rejection reasons for blocked recipients. Keep status values as server-provided states only.</action>
  <verify>`bunx tsc --noEmit -p apps/web/tsconfig.json` passes and route reads invite run detail via typed query.</verify>
  <done>Lifecycle visibility is operator-accessible with rejection transparency.</done>
</task>

<task type="auto">
  <name>Task 3: Register routes and regenerate route tree</name>
  <files>apps/web/src/routeTree.gen.ts</files>
  <action>Generate route tree artifacts after adding invite routes and ensure dashboard navigation references remain type-safe.</action>
  <verify>`bun run --filter web build` succeeds with generated route tree in sync.</verify>
  <done>Invite operations UI is integrated into typed route graph.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Invite send + lifecycle dashboard routes with server-backed status rendering</what-built>
  <how-to-verify>
    Visit the running web app and confirm:
    1. `/dashboard/invites` allows Parent Admin to trigger a send run.
    2. Newly created run appears with non-zero summary counters.
    3. `/dashboard/invites/{runId}` shows per-message lifecycle and blocked reason rows.
    4. No client-side status contradiction (detail view matches API state after refresh).
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>
</tasks>

<verification>
- [ ] `bunx tsc --noEmit -p apps/web/tsconfig.json` succeeds.
- [ ] `bun run --filter web build` succeeds.
- [ ] Invite dashboard and detail routes are present in generated route tree.
- [ ] Human verification confirms send + lifecycle UI behavior.
</verification>

<success_criteria>
- All tasks completed.
- Parent Admin can trigger sends and inspect lifecycle states from dashboard.
- UI consumes server status projections without client-side lifecycle recomputation.
</success_criteria>

<output>
After completion, create `.gsd/phases/03-whatsapp-invite-delivery-and-compliance-safety/03-04-SUMMARY.md`.
</output>
