---
phase: 05-parent-operations-dashboard-and-exports
plan: "03"
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - apps/web/src/routes/dashboard.operations.tsx
  - apps/web/src/components/operations/operations-filters.tsx
  - apps/web/src/components/operations/operations-metrics-cards.tsx
  - apps/web/src/routeTree.gen.ts
autonomous: false
user_setup: []
must_haves:
  truths:
    - "Parent-facing dashboard renders invited/responded/accepted/declined/pending cards from operations API data with no client-side count recomputation."
    - "Filter state (event/side/rsvpStatus) defaults to all/all/all, persists in URL query params, and supports one-click reset."
    - "Dashboard surfaces `Data as of` freshness and pre-export row count from the same backend contract used for CSV export."
  artifacts:
    - path: apps/web/src/routes/dashboard.operations.tsx
      provides: Parent operations route with filters, metrics cards, table view, pre-export count, and export action
      min_lines: 220
      contains: createFileRoute("/dashboard/operations")
    - path: apps/web/src/components/operations/operations-filters.tsx
      provides: Reusable filter controls for event, side, and RSVP status with URL-safe value mapping
      min_lines: 80
      contains: export function OperationsFilters
    - path: apps/web/src/components/operations/operations-metrics-cards.tsx
      provides: Metrics card group rendering invited/responded/accepted/declined/pending and freshness timestamp
      min_lines: 70
      contains: export function OperationsMetricsCards
  key_links:
    - from: apps/web/src/routes/dashboard.operations.tsx
      to: packages/api/src/routers/operations.ts
      via: Typed oRPC query/mutation wiring for metrics, preview row count, and CSV export
    - from: apps/web/src/components/operations/operations-filters.tsx
      to: .gsd/phases/05-parent-operations-dashboard-and-exports/05-CONTEXT.md
      via: Filter enum/default semantics match locked phase-05 decision contract
---

<objective>
Deliver the Phase 5 parent operations dashboard UI with count/filter/export workflows.

Purpose: Make OPS-01 and OPS-03 operationally usable by Parent Admins with low-friction, mobile-friendly decision surfaces.
Output: `/dashboard/operations` route with URL-persisted filters, metrics cards, data-freshness indicator, row preview, and export trigger.
</objective>

<execution_context>
@~/.kilocode/skills/execute-plan/SKILL.md
@~/.kilocode/rules/checkpoints.md
@.gsd/templates/summary.md
</execution_context>

<context>
@.gsd/ROADMAP.md
@.gsd/REQUIREMENTS.md
@.gsd/phases/05-parent-operations-dashboard-and-exports/05-CONTEXT.md
@.gsd/phases/05-parent-operations-dashboard-and-exports/05-01-PLAN.md
@.gsd/phases/05-parent-operations-dashboard-and-exports/05-02-PLAN.md
@apps/web/src/routes/dashboard.invites.tsx
@apps/web/src/routes/dashboard.events.$eventId.audience.tsx
@apps/web/src/components/ui/card.tsx
</context>

<tasks>
<task type="auto">
  <name>Task 1: Build operations dashboard route shell and data wiring</name>
  <files>apps/web/src/routes/dashboard.operations.tsx</files>
  <action>Create `/dashboard/operations` route that loads metrics, freshness timestamp, row previews, and export payload metadata from operations router procedures. Keep all metric values server-authored and render loading/error states with operator-readable copy.</action>
  <verify>Route compiles and renders API-backed metrics/freshness fields without local counting logic.</verify>
  <done>Parent Admin has a dedicated live operations dashboard surface.</done>
</task>

<task type="auto">
  <name>Task 2: Implement URL-persisted filter controls and reset flow</name>
  <files>apps/web/src/components/operations/operations-filters.tsx, apps/web/src/routes/dashboard.operations.tsx</files>
  <action>Implement event/side/rsvpStatus controls with defaults (`all/all/all`), strict AND query behavior via shared payload mapping, and `Reset filters` action that restores defaults. Persist filter values in route search params so reload/share reproduces the same view.</action>
  <verify>Changing filters updates URL query params and dashboard results; reset returns to defaults in URL and UI.</verify>
  <done>Operators can share and recover exact operational views quickly.</done>
</task>

<task type="auto">
  <name>Task 3: Add metrics cards, empty states, export preview CTA, and route registration</name>
  <files>apps/web/src/components/operations/operations-metrics-cards.tsx, apps/web/src/routes/dashboard.operations.tsx, apps/web/src/routeTree.gen.ts</files>
  <action>Add metric cards for invited/responded/accepted/declined/pending plus `Data as of` display. Render context-specific empty-state copy from phase-05 context, show pre-export row count, wire export trigger, and regenerate route tree.</action>
  <verify>`bun run --filter web build` succeeds and route tree includes `/dashboard/operations`.</verify>
  <done>UI now supports practical count review + export preparation in one place.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Parent operations dashboard route with filters, live count cards, freshness indicator, and CSV export trigger</what-built>
  <how-to-verify>
    Visit the running web app and confirm:
    1. `/dashboard/operations` loads invited/responded/accepted/declined/pending cards.
    2. Changing `event`, `side`, and `rsvpStatus` updates both results and URL query params.
    3. `Reset filters` returns to `all/all/all` and broadens the dataset.
    4. `Data as of` timestamp is visible near primary metrics.
    5. Export preview row count changes with filters and export action produces downloadable CSV output.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>
</tasks>

<verification>
- [ ] `bunx tsc --noEmit -p apps/web/tsconfig.json` succeeds.
- [ ] `bun run --filter web build` succeeds.
- [ ] Operations dashboard route appears in generated route tree.
- [ ] Human checkpoint confirms filter persistence/reset, count cards, freshness display, and export UX.
</verification>

<success_criteria>
- All tasks completed.
- OPS-01 and OPS-03 are operator-usable through dashboard UI behavior.
- UI contract stays aligned with backend count/export semantics.
</success_criteria>

<output>
After completion, create `.gsd/phases/05-parent-operations-dashboard-and-exports/05-03-SUMMARY.md`.
</output>
