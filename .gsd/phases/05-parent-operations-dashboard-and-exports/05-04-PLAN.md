---
phase: 05-parent-operations-dashboard-and-exports
plan: "04"
type: execute
wave: 3
depends_on: ["05-01", "05-02", "05-03"]
files_modified:
  - packages/api/src/services/operations-dashboard.test.ts
  - packages/api/src/services/operations-export.test.ts
  - .gsd/phases/05-parent-operations-dashboard-and-exports/05-VERIFICATION.md
autonomous: true
user_setup: []
must_haves:
  truths:
    - "OPS-01/OPS-02/OPS-03 outcomes are verification-backed with substantive evidence for metric semantics, filter alignment, and CSV contract stability."
    - "Export contract guarantees stable header order, deterministic row ordering, and headers-only output for empty datasets."
    - "Phase 05 exits with explicit pass/fail verdict and residual risk notes, including human checkpoint outcome from dashboard UX verification."
  artifacts:
    - path: packages/api/src/services/operations-dashboard.test.ts
      provides: Behavioral tests for person-level metrics and RSVP status filter semantics
      min_lines: 120
      contains: describe("operations dashboard service")
    - path: packages/api/src/services/operations-export.test.ts
      provides: Behavioral tests for export headers, deterministic ordering, and empty dataset behavior
      min_lines: 120
      contains: describe("operations export service")
    - path: .gsd/phases/05-parent-operations-dashboard-and-exports/05-VERIFICATION.md
      provides: Phase verification report with artifact/substance/wiring checks and final verdict
      min_lines: 120
      contains: "## Verdict"
  key_links:
    - from: packages/api/src/services/operations-dashboard.test.ts
      to: packages/api/src/services/operations-dashboard.ts
      via: Tests prove invited/responded/accepted/declined/pending and filter behavior invariants
    - from: packages/api/src/services/operations-export.test.ts
      to: packages/api/src/services/operations-export.ts
      via: Tests prove header/order/empty-output stability for vendor CSV contract
---

<objective>
Complete quality hardening and formal verification for phase-05 dashboard + export outcomes.

Purpose: Prove OPS-01, OPS-02, and OPS-03 with automated evidence plus a phase-level verification artifact.
Output: Targeted operations service tests and final `05-VERIFICATION.md` report with explicit verdict.
</objective>

<execution_context>
@~/.kilocode/skills/execute-plan/SKILL.md
@~/.kilocode/rules/verification-patterns.md
@.gsd/templates/verification-report.md
@.gsd/templates/summary.md
</execution_context>

<context>
@.gsd/phases/05-parent-operations-dashboard-and-exports/05-01-PLAN.md
@.gsd/phases/05-parent-operations-dashboard-and-exports/05-02-PLAN.md
@.gsd/phases/05-parent-operations-dashboard-and-exports/05-03-PLAN.md
@packages/api/src/services/operations-dashboard.ts
@packages/api/src/services/operations-export.ts
@packages/api/src/routers/operations.ts
@apps/web/src/routes/dashboard.operations.tsx
</context>

<tasks>
<task type="auto">
  <name>Task 1: Add operations dashboard service behavior tests</name>
  <files>packages/api/src/services/operations-dashboard.test.ts</files>
  <action>Add tests validating person-level metrics, `pending = invited - responded` semantics, strict AND filter behavior (event + side + rsvpStatus), and freshness timestamp projection for filtered datasets.</action>
  <verify>Tests fail when metric semantics are intentionally broken and pass with correct implementation.</verify>
  <done>OPS-01/OPS-03 metric and filter contracts are regression-protected.</done>
</task>

<task type="auto">
  <name>Task 2: Add operations export contract tests</name>
  <files>packages/api/src/services/operations-export.test.ts</files>
  <action>Add tests for exact header order, deterministic sort order (event date -> side -> guest unit name -> person name), null-field serialization consistency, and headers-only output for empty datasets.</action>
  <verify>Export tests assert exact CSV shape and row order determinism across repeated runs.</verify>
  <done>OPS-02 CSV contract is stable and vendor-safe.</done>
</task>

<task type="auto">
  <name>Task 3: Produce phase verification report with checkpoint outcome</name>
  <files>.gsd/phases/05-parent-operations-dashboard-and-exports/05-VERIFICATION.md</files>
  <action>Run verification-pattern checks for all phase-05 artifacts, capture human checkpoint result from `05-03`, and publish explicit pass/fail verdict with any residual risks and mitigations.</action>
  <verify>Verification report includes evidence-backed status for OPS-01, OPS-02, OPS-03 and a clear final verdict section.</verify>
  <done>Phase 05 completion is decision-ready with traceable verification evidence.</done>
</task>
</tasks>

<verification>
- [ ] `bun test packages/api/src/services/operations-dashboard.test.ts packages/api/src/services/operations-export.test.ts` passes.
- [ ] `bunx tsc --noEmit -p packages/api/tsconfig.json` succeeds.
- [ ] Human checkpoint result from `05-03` is captured in verification report.
- [ ] `05-VERIFICATION.md` declares clear verdict for OPS-01/OPS-02/OPS-03.
</verification>

<success_criteria>
- All tasks completed.
- Automated tests prove operations metric/filter/export invariants.
- Phase 05 has a complete verification artifact with explicit verdict.
</success_criteria>

<output>
After completion, create `.gsd/phases/05-parent-operations-dashboard-and-exports/05-04-SUMMARY.md`.
</output>
